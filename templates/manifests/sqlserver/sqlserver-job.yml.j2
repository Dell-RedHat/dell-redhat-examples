apiVersion: batch/v1
kind: Job
metadata:
  name: mssqlcli-operations
  namespace: sqlserver
  labels:
    app: sqljob
spec:
  parallelism: 1
  completions: 1
  activeDeadlineSeconds: 1800
  backoffLimit: 6
  template:
    metadata:
      name: mssqlcli-operations
      labels:
        app: sqljob
    spec:
      containers:
      - name: mssqlcli-operations
        image: mcr.microsoft.com/mssql-tools
        command:
        - /bin/bash
        - '-c'
        - |
          /opt/mssql-tools/bin/sqlcmd -U SA -P YourStrong!Passw0rd -S sqlserver-service.sqlserver.svc.cluster.local -Q "IF NOT EXISTS (SELECT * FROM sys.databases WHERE name = 'sqlserverdemo') CREATE DATABASE sqlserverdemo; SELECT name, database_id, create_date FROM sys.databases;"
          /opt/mssql-tools/bin/sqlcmd -U SA -P YourStrong!Passw0rd -S sqlserver-service.sqlserver.svc.cluster.local -Q "USE sqlserverdemo; CREATE TABLE tbluser ([user_id] [bigint] IDENTITY (1,10) , [user_name] [varchar] (50) ); INSERT INTO tbluser ([user_name]) values ( 'demouser' ); SELECT * FROM tbluser;"
      restartPolicy: OnFailure

